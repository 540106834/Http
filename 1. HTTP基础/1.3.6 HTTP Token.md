# **最完整、最标准、最实战的 HTTP Token 讲解**

* HTTP Token 是什么
* Token 在 HTTP 中的标准写法
* 三种主流 Token 类型（Bearer / Basic / API Key）
* 请求和响应的原始格式
* Prometheus / Alertmanager / Python 如何用 Token

你看完之后就完全掌握 **HTTP Token**。


#  一、HTTP Token 是什么？

HTTP Token = **客户端在请求中拿来证明自己的“身份”或“权限”的字符串”**。

最常见位置：**HTTP Header → Authorization 字段**

格式：

```
Authorization: <类型> <token值>
```

这是 HTTP 认证的正式标准（RFC 7235）。

---

#  二、HTTP Token 的三种主流格式

## ① Bearer Token（最常用，现代 API 的标准）

**99% 的 REST API 都在用。
Prometheus、Alertmanager、Grafana、Kubernetes 全都支持。**

格式：

```
Authorization: Bearer <token>
```

示例：

```
Authorization: Bearer abcd1234efgh5678
```

意思：

> “我是 bearer token abcd1234，请信任我。”

---

## ② Basic Token（用户名+密码 base64）

格式：

```
Authorization: Basic base64(username:password)
```

示例：

```
Authorization: Basic YWRtaW46MTIzNA==
```

适合：

* 简单认证
* 基础的 HTTP 接口（如某些 Kubernetes 旧接口）

---

## ③ API Key（通用 Token，不一定用 Authorization）

有些服务不用 Bearer，用 Key，写法有两种：

### 写在 Header：

```
X-API-Key: 123456789
```

### 写在 Authorization：

```
Authorization: ApiKey 123456789
```

### 写在 URL（不建议）

```
GET /api?token=123456
```

---

#  三、HTTP Token 完整原始请求示例（抓包级）

```
GET /v1/metrics HTTP/1.1
Host: example.com
Authorization: Bearer eyJhbGciOiJIUz
Accept: application/json
User-Agent: curl/8.0

```

关键点：

1. **Token 在 Header 内**
2. 写在 `Authorization` 字段
3. 无空格以外不得有额外符号

---

#  四、服务端如何校验 Token？

一个典型 HTTP 服务器会做：

```
1. 读取 Authorization header
2. 判断类型是否是 Bearer / Basic / ApiKey
3. 验证这个 token 是否在数据库/缓存中
4. 如果有效 → 继续处理
5. 无效 → 401 Unauthorized
```

示例响应（无 Token 或 Token 错）：

```
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="example"
```

---

#  五、在 Prometheus / Alertmanager 中使用 HTTP Token

## Prometheus 使用 Token 抓取数据：

```
scrape_configs:
- job_name: "node"
  bearer_token: /var/run/secrets/kubernetes.io/serviceaccount/token
```

发送请求时：

```
Authorization: Bearer <token>
```

---

## Alertmanager 发通知时使用 Token（webhook）：

```
receivers:
- name: webhook
  webhook_configs:
  - url: http://server:8000/alert
    http_config:
      authorization:
        type: Bearer
        credentials: 123456
```

效果：

```
Authorization: Bearer 123456
```

---

#  六、Python 请求中加入 Token（你肯定会用）

## requests 示例：

```python
import requests

headers = {"Authorization": "Bearer 12345abcd"}
resp = requests.get("https://example.com/api", headers=headers)
print(resp.json())
```

---

#  七、最简总结（面试回答模板）

**HTTP Token 就是客户端通过 HTTP Header 的 Authorization 字段携带的认证字符串。
最基本格式：**

```
Authorization: Bearer <token>
```

Token 的作用：

* 证明身份
* 授权访问资源
* 替代用户名密码
* 常用于所有现代 REST API / 微服务 / 云原生系统

---

# 如果你愿意，我还可以继续给你：

✔ Token 在 HTTP/1.1 vs HTTP/2 的区别
✔ Token 在 HTTPS 中是否安全？
✔ 如何生成一个安全 Token？
✔ Token 过期/刷新机制（JWT）
✔ 你的业务里 Token 应该放哪里？（Header 还是 URL？）

你要继续哪一部分？
