
#  **网络排错必备 8 步（从底层 → 顶层）**

下面是一套你写下来的命令，我给你补全解释、目的和例子。

---

# **① `ip a` — 检查本机网卡是否正常**

### 目的

* 网卡是否 UP
* 是否有 IP 地址
* 是否有正确的网关所在网段

### 你应该检查：

* `state UP`
* 是否拿到 IP
* 是否是你期望的网段（例如 192.168.1.x）

---

# **② `ping 网关` — 检查本机到网关是否通**

### 目的

验证二三层是否正常（ARP、交换机、网关路由等）。

### 成功

说明：

* 本机网卡 OK
* 局域网交换机 OK
* 网关 OK

### 失败：常见原因

* 网线 / 物理层问题
* ARP 无法解析（`arp -n` 查看）
* 网关设备挂了
* VLAN 错误

---

# **③ `ping 外网（如 8.8.8.8）` — 检查是否能出网**

### 目的

验证路由、防火墙、NAT 是否正常。

### 成功

* 本机 → 网关 → 对外路由 → NAT 都正常

### 失败：

* 网关防火墙没有放行
* NAT 没有配置
* 出站路由缺失
* 上级网络故障

---

# **④ `traceroute 目标` — 检查流量在哪一跳断掉**

### 目的

定位失败点

* 是第 2 跳（网关）断？
* 第 3-4 跳（运营商）断？

这步能非常快定位是哪一段网络引起。

### 示例

```
traceroute 8.8.8.8
```

---

# **⑤ `nc -vz host port` — 检查目标端口是否可达（TCP）**

### 目的

测试 TCP 层连通性（三次握手是否成功）。

### 成功例子

```
nc -vz 10.0.0.5 3306
Connection to host 3306 port [tcp/mysql] succeeded!
```

### 失败

* 端口未监听
* 防火墙阻止
* 网络 ACL 阻止
* 对端服务没启动

---

# **⑥ `ss -lntup` — 查看本机端口监听情况**

### 目的

确认服务是否真的在监听。

### 你要关注：

* LISTEN 状态
* 端口是否正确
* PID 是否存在

---

# **⑦ `curl -v` — 查看应用层 HTTP 问题**

### 目的

检查 HTTP 层：

* 请求是否发出去
* TLS 是否握手
* 返回状态码是多少
* 服务器是否返回错误

### 示例

```
curl -v http://10.0.0.5:8080/api/test
```

---

# **⑧ `tcpdump port xxxx` — 抓包确认是否真的有流量**

### 目的

最底层验证：请求到底有没有进来 / 出去。

### 示例

```
tcpdump -i eth0 port 8080
```

你可以看到：

* SYN 是否发出
* SYN/ACK 是否返回
* HTTP 是否有报文

这可以验证是否是网络问题还是应用问题。

---

#  **完整网络排查最短流程（背下来就够用）**

```
1. ip a                       # 本机网络
2. ping 网关                  # 局域网 / 网关
3. ping 外网(8.8.8.8)         # 出口网络 / NAT
4. traceroute 目标             # 路由路径定位
5. nc -vz host port           # TCP 端口可达性
6. ss -lntup                  # 服务是否监听
7. curl -v                    # 应用层检查
8. tcpdump port xxx           # 最终抓包分析
```


