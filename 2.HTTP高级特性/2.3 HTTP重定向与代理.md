# **HTTP 重定向（Redirect）** 和 **HTTP 代理（Proxy）** 


#  一、HTTP 重定向（HTTP Redirect）

**重定向 = 服务器告诉客户端换个地址重新访问。**

### ▶ 动作发起方

**由服务器发起，客户端执行。**

### ▶ 工作机制

服务器返回一个 3xx 状态码 + 新地址（Location）。
客户端收到后，再主动向新的 URL 发起新的请求。

### ▶ 常见状态码

| 状态码           | 含义                                |
| ------------- | --------------------------------- |
| **301**       | 永久重定向                             |
| **302**       | 临时重定向                             |
| **307 / 308** | 与 302/301 类似但不会改变方法（POST 不变成 GET） |

### ▶ 重定向示例

客户端请求：

```
GET /login HTTP/1.1
Host: example.com
```

服务端返回：

```
HTTP/1.1 302 Found
Location: https://login.example.com/
```

浏览器再次请求：

```
GET / HTTP/1.1
Host: login.example.com
```

### ▶ 特点总结

* **客户端需要访问两次（跳转）**
* **源服务器不传输内容，只告诉你地址**
* 浏览器会自动处理
* 对网络层负载不大
* URL 会改变
* 常用于：

  * HTTP → HTTPS 强制跳转
  * 网站迁移
  * 登录跳转

---

#  二、HTTP 代理（HTTP Proxy）

**代理 = 客户端通过中间服务器访问目标服务器。**

### ▶ 动作发起方

**客户端发起请求，但请求最终由代理服务器转发。**

### ▶ 工作机制

客户端 → Proxy → 上游服务器
上游返回 → Proxy → 客户端

浏览器不直接访问目标服务器。

### ▶ 代理请求示例（HTTP CONNECT 或 Forward Proxy）

客户端发给代理服务器：

```
GET http://example.com/resource HTTP/1.1
Host: example.com
```

代理服务器再向 example.com 发送：

```
GET /resource HTTP/1.1
Host: example.com
```

### ▶ 特点总结

* 客户端请求 **不需要访问原服务器地址**
* URL **通常不改变**（客户端看到的 URL 不变）
* 可做缓存、审计、内容替换、权限控制
* 用于：

  * 科学上网（forward proxy）
  * 企业网内的 web 代理
  * API Gateway
  * CDN 反向代理（如 Nginx、Cloudflare）

---

#  三、重定向 vs 代理 —— 一张表看懂

| 功能           | HTTP 重定向         | HTTP 代理              |
| ------------ | ---------------- | -------------------- |
| 谁处理跳转/转发？    | 客户端              | 代理服务器                |
| 客户端访问目标服务器？  | **是（需要再次访问新地址）** | **否（代理代替访问）**        |
| 是否发起二次请求？    | **是**            | 否                    |
| 客户端 URL 会变吗？ | **会**            | 不会                   |
| 常见用途         | 登录跳转、HTTPS 强制    | CDN、API Gateway、安全审计 |

---

#  四、实际案例对比

### **案例 1：HTTP → HTTPS 强制跳转**（使用重定向）

nginx:

```
return 301 https://$host$request_uri;
```

浏览器收到 301，重新访问 HTTPS。

### **案例 2：Nginx / Envoy / Traefik 反向代理**（使用代理）

客户端：

```
GET /api/user
Host: api.example.com
```

Nginx：

```
proxy_pass http://backend-service;
```

Nginx 会自己转发到后端，而不是让客户端访问后端。

### **案例 3：CDN（Cloudflare/CloudFront）**

CDN = 强力代理（反向代理）+ 缓存
用户永远不访问真实服务器。

---

#  五、混淆点说明

### ❗ 重定向不是负载均衡

重定向非常慢，因为客户端要发第二次请求，所以生产负载均衡不用重定向。

### ❗ 代理不会让浏览器跳转

如果你看到浏览器地址栏变了 → 那是重定向
如果你看到地址不变但内容来自别处 → 那是代理

### ❗ L7 代理有能力修改内容，而重定向没有

代理可以：

* 添加鉴权头
* 限流
* 改动路径 /api → /v1/api
* 加缓存

重定向完全做不到。

---

#  你要哪种的进一步深入说明？

我可以继续讲：

✅ 反向代理 vs 正向代理
✅ Nginx/Envoy/Traefik 实现原理
✅ 负载均衡与重定向关系
✅ HTTP 301 vs 302 vs 307 区别
✅ OAuth2 登录流程与 redirect_uri
✅ Kubernetes Ingress 如何处理 302

你想继续深入哪一块？
