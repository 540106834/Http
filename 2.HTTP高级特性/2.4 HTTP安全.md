我们来系统梳理 **HTTP 安全**，从基础概念到常见威胁、最佳实践，再到实际生产环境应用。内容分层次讲清楚，让你既明白原理，也能落地实践。

---

# 🟦 一、HTTP 安全基础

HTTP 本身是 **明文协议**：

```
GET /login HTTP/1.1
Host: example.com
Cookie: sessionid=abcd1234
```

* 数据明文传输，任何中间节点都能看到请求内容和响应内容
* 不安全，容易被窃听、篡改、伪造

### ✅ 解决方案：HTTPS

* HTTPS = HTTP over TLS
* 数据加密（对称加密）
* 身份验证（证书/CA）
* 数据完整性（防篡改）

---

# 🟦 二、常见 HTTP 威胁

| 威胁                   | 描述                         | 防御措施                                  |
| -------------------- | -------------------------- | ------------------------------------- |
| **中间人攻击 (MITM)**     | 攻击者窃听或篡改 HTTP 流量           | 使用 HTTPS、HSTS、证书校验                    |
| **Cookie 泄露**        | 明文 Cookie 可能被窃取            | 设置 HttpOnly、Secure、SameSite 属性        |
| **跨站脚本攻击 (XSS)**     | 恶意 JS 注入网页                 | 输出编码、CSP、Input 验证                     |
| **跨站请求伪造 (CSRF)**    | 利用用户已登录状态发起恶意请求            | CSRF Token、SameSite Cookie、Referer 校验 |
| **Clickjacking**     | 页面被嵌入 iframe 做恶意点击         | X-Frame-Options、CSP frame-ancestors   |
| **HTTP 请求劫持 / 缓存投毒** | HTTP 缓存被篡改                 | HTTPS + Cache-Control 指定缓存策略          |
| **敏感信息泄露**           | URL、Referer、Header 中包含敏感信息 | 避免在 URL 传输密码或 Token，敏感 Header 加密或隐藏   |

---

# 🟦 三、HTTP 常用安全头（HTTP Header Security）

1. **HSTS（HTTP Strict Transport Security）**

   ```
   Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
   ```

   * 强制浏览器使用 HTTPS
   * 防止协议降级攻击

2. **X-Frame-Options / CSP frame-ancestors**

   ```
   X-Frame-Options: DENY
   Content-Security-Policy: frame-ancestors 'none'
   ```

   * 防止 Clickjacking

3. **X-Content-Type-Options**

   ```
   X-Content-Type-Options: nosniff
   ```

   * 阻止浏览器 MIME 类型嗅探，防止文件类型攻击

4. **X-XSS-Protection**（老浏览器）

   ```
   X-XSS-Protection: 1; mode=block
   ```

   * 启用浏览器 XSS 过滤

5. **Content-Security-Policy (CSP)**

   ```
   Content-Security-Policy: default-src 'self'; script-src 'self'
   ```

   * 防止 XSS、数据注入、资源加载篡改

6. **Referrer-Policy**

   ```
   Referrer-Policy: no-referrer
   ```

   * 控制 Referer 头泄露敏感信息

---

# 🟦 四、Cookie 安全策略

| 属性                      | 功能                |
| ----------------------- | ----------------- |
| **Secure**              | 仅在 HTTPS 下发送      |
| **HttpOnly**            | JS 无法读取，防止 XSS 窃取 |
| **SameSite=Strict/Lax** | 防止 CSRF           |
| **Max-Age / Expires**   | 控制生命周期，减少长期泄露风险   |

---

# 🟦 五、认证与 Token 安全

1. **避免在 URL 里传 Token**

   * URL 会被日志记录，容易泄露
2. **使用 HTTPS 传输 Token / Cookie**
3. **短期 Token + 刷新机制**
4. **签名 Token（JWT）**

   * HMAC 或 RSA 签名防篡改
   * Payload 可以包含过期时间、权限信息
5. **对敏感接口增加二次验证**

   * 例如敏感操作用 OTP 或多因子验证

---

# 🟦 六、HTTP 安全最佳实践

1. 全站启用 **HTTPS**，不要兼容 HTTP
2. 使用 **HSTS**，避免协议降级
3. 对所有输入进行验证和输出编码
4. 使用 **CSP、X-Frame-Options、防 XSS**
5. Cookie 设置 **Secure + HttpOnly + SameSite**
6. Token 不放 URL、使用短期有效 + 签名
7. 定期扫描应用漏洞和安全头缺失
8. 对敏感接口启用 **速率限制、IP 白名单、WAF**

---

# 🟦 七、进阶安全措施

* **API Gateway / WAF**：统一入口做认证、限流、防攻击
* **TLS 最佳实践**：使用 TLS1.2/1.3，禁用 SSL/TLS 弱协议
* **安全日志**：记录异常访问、拒绝服务尝试
* **安全更新**：HTTP 服务器、依赖库及时打补丁

---

如果你愿意，我可以帮你画一张 **HTTP 安全全景图**：

* 明文 HTTP 风险
* HTTPS 加密传输
* 安全头策略
* Cookie / Token 安全
* 攻击类型与防御路径

这张图可以让你对 HTTP 安全有 **一眼全局理解**。

你希望我画吗？
